Resources:
  ForestDoc:
    Type: "AWS::SSM::Document"
    Properties:
      DocumentType: Automation 
      Content:
        description: Systems Manager Automation - Build a New Active Directory Forest from Scratch
        schemaVersion: '0.3'
        parameters:
          echo_message:
          type: String
          default: 'hello-world'
        mainSteps:
          - name: echo_test
            action: aws:runCommand
            maxAttempts: 1
            onFailure: Abort
            inputs:
              DocumentName: AWS-RunPowerShellScript
              echo_message: '{{"{{"}}echo_message{{"}}"}}'
              Parameters:
                commands:  Invoke-Expression ([System.Text.Encoding]::Unicode.GetString([Convert]::FromBase64String("{{ b64_create_forest.output }}")))  
            executionTimeout: '3600'